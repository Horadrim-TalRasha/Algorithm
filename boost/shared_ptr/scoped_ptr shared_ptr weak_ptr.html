<!DOCTYPE html>
<!-- saved from url=(0037)http://www.jb51.net/article/41352.htm -->
<html lang="zh-CN"><head><meta http-equiv="Content-Type" content="text/html; charset=GBK"><script src="./scoped_ptr shared_ptr weak_ptr_files/ca-pub-6384567588307613.js"></script><script type="text/javascript" charset="utf-8" src="./scoped_ptr shared_ptr weak_ptr_files/changyan.js"></script>
<meta charset="gb2312">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="Cache-Control" content="no-siteapp">
<meta http-equiv="Cache-Control" content="no-transform">
<title>浅析Boost智能指针:scoped_ptr shared_ptr weak_ptr_C 语言_脚本之家</title>
<meta http-equiv="X-UA-Compatible" content="IE=9; IE=8; IE=7; IE=EDGE">
<meta name="keywords" content="scoped_ptr,shared_ptr,weak_ptr">
<meta name="description" content="虽然通过弱引用指针可以有效的解除循环引用，但这种方式必须在程序员能预见会出现循环引用的情况下才能使用，也可以是说这个仅仅是一种编译期的解决方案，如果程序在运行过程中出现了循环引用，还是会造成内存泄漏的">
<link rel="alternate" media="only screen and(max-width: 640px)" href="http://m.jb51.net/article/41352.htm">
<meta http-equiv="mobile-agent" content="format=html5; url=http://m.jb51.net/article/41352.htm">
<meta http-equiv="mobile-agent" content="format=xhtml; url=http://m.jb51.net/article/41352.htm">
<script src="./scoped_ptr shared_ptr weak_ptr_files/hm.js"></script><script type="text/javascript" async="" src="./scoped_ptr shared_ptr weak_ptr_files/hcom"></script><script type="text/javascript" async="" src="./scoped_ptr shared_ptr weak_ptr_files/dynamicFloat.js"></script><script src="./scoped_ptr shared_ptr weak_ptr_files/push.js"></script><script type="text/javascript" async="" src="./scoped_ptr shared_ptr weak_ptr_files/hcom(1)"></script><script type="text/javascript" async="" src="./scoped_ptr shared_ptr weak_ptr_files/hcom(2)"></script><script type="text/javascript" async="" src="./scoped_ptr shared_ptr weak_ptr_files/hcom(3)"></script><script type="text/javascript" async="" src="./scoped_ptr shared_ptr weak_ptr_files/hcom(4)"></script><script type="text/javascript" async="" src="./scoped_ptr shared_ptr weak_ptr_files/hcom(5)"></script><script type="text/javascript">
var tougao="jingxian";var lmname="C 语言";
(function(){var ua=navigator.userAgent.toLowerCase();var bIsIpad=ua.match(/ipad/i)=="ipad";var bIsIphoneOs=ua.match(/iphone os/i)=="iphone os";var bIsAndroid=ua.match(/android/i)=="android";var bIsWM=ua.match(/windows mobile/i)=="windows mobile";if(bIsIpad||bIsIphoneOs||bIsAndroid||bIsWM){window.location.href="http://m.jb51.net/article/41352.htm"}})();
</script>
<link type="text/css" href="./scoped_ptr shared_ptr weak_ptr_files/base.css" rel="stylesheet">
<link type="text/css" href="./scoped_ptr shared_ptr weak_ptr_files/common.css" rel="stylesheet">
<script type="text/javascript" src="./scoped_ptr shared_ptr weak_ptr_files/jquery.min.js"></script>
<script type="text/javascript" src="./scoped_ptr shared_ptr weak_ptr_files/common.js"></script>
<script src="./scoped_ptr shared_ptr weak_ptr_files/share.js"></script><script type="text/javascript" charset="UTF-8" src="./scoped_ptr shared_ptr weak_ptr_files/version-v3.js"></script><link rel="stylesheet" href="./scoped_ptr shared_ptr weak_ptr_files/share_style0_16.css"><script type="text/javascript" charset="UTF-8" src="./scoped_ptr shared_ptr weak_ptr_files/cookie"></script><script type="text/javascript" charset="UTF-8" src="./scoped_ptr shared_ptr weak_ptr_files/adapter.min.js"></script><script type="text/javascript" charset="UTF-8" src="./scoped_ptr shared_ptr weak_ptr_files/cyrHH3dwi"></script><script type="text/javascript" charset="UTF-8" src="./scoped_ptr shared_ptr weak_ptr_files/version.js"></script><script type="text/javascript" charset="UTF-8" src="./scoped_ptr shared_ptr weak_ptr_files/cookie(1)"></script><script type="text/javascript" charset="UTF-8" src="./scoped_ptr shared_ptr weak_ptr_files/cyrHH3dwi(1)"></script><script type="text/javascript" charset="UTF-8" src="./scoped_ptr shared_ptr weak_ptr_files/event"></script><script type="text/javascript" charset="UTF-8" src="./scoped_ptr shared_ptr weak_ptr_files/sea.v2.2.0.js"></script><script type="text/javascript" charset="UTF-8" src="./scoped_ptr shared_ptr weak_ptr_files/app-build.js"></script><link rel="stylesheet" type="text/css" href="./scoped_ptr shared_ptr weak_ptr_files/upload-img.css"><style id="changyanCss">#SOHUCS{clear:both;min-height:320;_height:320px;overflow:visible;}#SOHUCS iframe{width:100%;min-height:320px;_height:320px;}</style><link charset="utf-8" rel="stylesheet" href="./scoped_ptr shared_ptr weak_ptr_files/changyan2.css"><link charset="utf-8" rel="stylesheet" href="./scoped_ptr shared_ptr weak_ptr_files/default.css"><script type="text/javascript" charset="UTF-8" src="./scoped_ptr shared_ptr weak_ptr_files/main.js"></script><script type="text/javascript" charset="UTF-8" src="./scoped_ptr shared_ptr weak_ptr_files/render-pc.js"></script></head>
<body style=""><div id="BAIDU_DUP_fp_wrapper" style="position: absolute; left: -1px; bottom: -1px; z-index: 0; width: 0px; height: 0px; overflow: hidden; visibility: hidden; display: none;"><iframe id="BAIDU_DUP_fp_iframe" src="./scoped_ptr shared_ptr weak_ptr_files/o.html" style="width: 0px; height: 0px; visibility: hidden; display: none;"></iframe></div><div id="BAIDU_SSP__wrapper_u480030_0_right" style="box-sizing: content-box; width: 131px; height: 301px; overflow: hidden; z-index: 2147483647; position: fixed; top: 150px; right: 10px;"><div style="box-sizing: content-box;width:120px;height:270px;padding:4px;border:#acacac 1px solid;overflow:hidden;"><iframe id="BAIDU_SSP__wrapper_u480030_0_right_iframe" src="./scoped_ptr shared_ptr weak_ptr_files/hcom.html" width="120" height="270" align="center,center" vspace="0" hspace="0" marginwidth="0" marginheight="0" scrolling="no" frameborder="0" style="border:0; vertical-align:bottom;margin:0;" allowtransparency="true"></iframe></div><div id="BAIDU_SSP__wrapper_u480030_0_right_closebtn" style="box-sizing: content-box; position: absolute; width: 131px; height: 20px; left: 0px; cursor: pointer; color: rgb(255, 255, 255); font-size: 12px; font-family: 微软雅黑; text-align: center; line-height: 20px; background-color: rgb(153, 153, 153);">关闭</div></div>
<!--head Star -->
<div id="head">
  <div class="toolBar">
  <div class="main">
    <!--topNav Star -->
    <div class="topNav clearfix">
      <ul class="navList fl">
        <li>
          <div class="one"><a href="http://www.jb51.net/" target="_blank">脚本之家</a></div>
        </li>
        <li>
          <div class="one"><a href="http://www.jb51.net/softs/" target="_blank">软件下载<i class="icon"></i></a></div>
          <div class="two">
<a href="http://www.jb51.net/softs/android.html" target="_blank">android软件</a> <a href="http://www.jb51.net/softs/mac.html" target="_blank">MAC软件</a> <a href="http://www.jb51.net/qudong/" target="_blank">驱动下载</a> <a href="http://www.jb51.net/fonts/" target="_blank">字体下载</a> <a href="http://www.jb51.net/dll/" target="_blank">DLL下载</a> </div>
</li>
        <li class="">
          <div class="one"><a href="http://www.jb51.net/codes/" target="_blank">源码下载<i class="icon"></i></a></div>
          <div class="two"> <a href="http://www.jb51.net/codes/asp.html" target="_blank">asp源码</a> <a href="http://www.jb51.net/codes/php.html" target="_blank">php源码</a> <a href="http://www.jb51.net/codes/aspnet.html" target="_blank">asp.net源码</a> <a href="http://www.jb51.net/codes/jsp.html" target="_blank">jsp源码</a> <a href="http://www.jb51.net/codes/editor.html" target="_blank">网页编辑器</a> <a href="http://www.jb51.net/codes/list123_1.html" target="_blank">数据库管理</a> <a href="http://www.jb51.net/codes/list124_1.html" target="_blank">常用组件</a> <a href="http://www.jb51.net/jiaoben/" target="_blank">脚本下载</a></div>
        </li>
        <li>
          <div class="one"><a href="http://tools.jb51.net/" target="_blank">在线工具<i class="icon"></i></a></div>
          <div class="two"> <a href="http://www.jb51.net/shouce/" target="_blank">在线手册</a> <a href="http://www.jb51.net/tools/cssyasuo.shtml" target="_blank">CSS格式化</a> <a href="http://tools.jb51.net/tools/js_geshihua.asp" target="_blank">JS格式化</a> <a href="http://www.jb51.net/tools/html-js.htm" target="_blank">Html转化为Js</a> <a href="http://tools.jb51.net/regex/javascript" target="_blank">js正则表达式</a>
</div>
        </li>
        <li>
          <div class="one"><a href="http://www.jb51.net/w3school/" target="_blank">网页教程基础</a></div>
        </li>
			<li>
          <div class="one"><a href="http://s.jb51.net/" target="_blank">服务器常用软件</a></div>
        </li>
		<li>
          <div class="one"><a href="http://m.jb51.net/" target="_blank">手机版</a></div>
          <div class="two"><img src="./scoped_ptr shared_ptr weak_ptr_files/m.jb51.net.png" data-baiduimageplus-ignore=""></div>     
        </li>
        <li class="watch">
          <div class="one"><a href="http://weibo.com/jb51net" target="_blank" rel="nofollow"><i class="icon"></i>关注微信</a></div>
          <div class="two"><img src="./scoped_ptr shared_ptr weak_ptr_files/weixin_200.gif" data-baiduimageplus-ignore=""></div>
        </li>
      </ul>
      <div class="navUser mt5 fr" id="jb51_topbar"> </div>
    </div>
    <!--topNav End -->
  </div>
</div>

  <div class="main clearfix">
    <div class="mtb10 clearfix">
      <div class="logo"><a href="http://www.jb51.net/"><img src="./scoped_ptr shared_ptr weak_ptr_files/logo.gif" title="脚本之家" alt="脚本之家"></a></div>
      <div class="logom fl" id="logo_m"><a href="http://www.zzidc.com/main/huodong/halfnewYear/pand_2331.html" target="_blank"><img src="./scoped_ptr shared_ptr weak_ptr_files/jingan_370.gif" width="370" height="60"></a></div>
      <div class="logor fr" id="logo_r"><a href="http://www.ku86.com/" target="_blank"><img src="./scoped_ptr shared_ptr weak_ptr_files/kuyun_370.gif" width="370" height="60"></a></div>
    </div>
<!-- 导航-->
<div class="nav_top clearfix">
<ul>
<li><a href="http://www.jb51.net/web/">网页制作</a></li>
<li><a href="http://www.jb51.net/list/index_1.htm">网络编程</a></li>
<li><a href="http://www.jb51.net/list/index_96.htm">脚本专栏</a></li>
<li><a href="http://www.jb51.net/jiaoben/">脚本下载</a></li>
<li><a href="http://www.jb51.net/list/index_104.htm">数据库</a></li>
<li><a href="http://www.jb51.net/cms/">CMS教程</a></li>
<li><a href="http://www.jb51.net/books/">电子书籍</a></li>
<li><a href="http://www.jb51.net/pingmian/">平面设计</a></li>
<li><a href="http://www.jb51.net/media/">媒体动画</a></li>
<li><a href="http://www.jb51.net/os/">操作系统</a></li>
<li><a href="http://www.jb51.net/yunying/">网站运营</a></li>
<li><a href="http://www.jb51.net/hack/">网络安全</a></li>
<li class="last"><a href="http://www.jb51.net/shouce/">在线手册</a></li>

</ul>
</div>

<!--导航结束-->
<div class="subnav clearfix">
<ul><li><a href="http://www.jb51.net/list/list_85_1.htm" title="C#教程">C#教程</a></li>
<li><a href="http://www.jb51.net/list/list_93_1.htm" title="vb">vb</a></li>
<li><a href="http://www.jb51.net/list/list_205_1.htm" title="vb.net">vb.net</a></li>
<li><a href="http://www.jb51.net/list/list_159_1.htm" title="C 语言">C 语言</a></li>
<li><a href="http://www.jb51.net/list/list_134_1.htm" title="Java编程">Java编程</a></li>
<li><a href="http://www.jb51.net/list/list_206_1.htm" title="Delphi">Delphi</a></li>
<li><a href="http://www.jb51.net/list/list_207_1.htm" title="java">java</a></li>
<li><a href="http://www.jb51.net/list/list_233_1.htm" title="Android">Android</a></li>
<li><a href="http://www.jb51.net/list/list_238_1.htm" title="IOS">IOS</a></li>
<li><a href="http://www.jb51.net/list/list_244_1.htm" title="Swift">Swift</a></li>
<li><a href="http://www.jb51.net/list/list_250_1.htm" title="Scala">Scala</a></li>
<li><a href="http://www.jb51.net/list/list_188_1.htm" title="其它相关">其它相关</a></li>
</ul>
</div>
<div class="NavBar clearfix ptb10">
<div class="fl w690">
<div class="box mb15 mt10"><i class="icon"></i>您的位置：<a href="http://www.jb51.net/">首页</a> → <a href="http://www.jb51.net/list/index_84.htm" title="软件编程">软件编程</a> → <a href="http://www.jb51.net/list/list_159_1.htm" title="C 语言">C 语言</a> → 正文内容 weak ptr</div>
</div>
<div class="fr w300"><div class="search">
<form action="http://so.jb51.net/cse/search" target="_blank">
    <input type="hidden" name="s" value="10520733385329581432">
    <input type="hidden" name="ie" value="gbk">
    <input type="text" name="q" class="key_input" placeholder="请输入关键词">
    <input type="submit" value="搜索" class="c_btn">
</form></div></div>
  </div>
</div>
<!--head End -->
<div class="main mb10 clearfix">
<div class="tonglanad clearfix" id="tonglanbd"><script type="text/javascript">dy("tonglanbd")</script><script type="text/javascript">var cpro_id = "u336546";</script><script src="./scoped_ptr shared_ptr weak_ptr_files/c.js" type="text/javascript"></script><div id="BAIDU_SSP__wrapper_u336546_0"><iframe id="iframeu336546_0" src="./scoped_ptr shared_ptr weak_ptr_files/hcom(6).html" width="960" height="90" align="center,center" vspace="0" hspace="0" marginwidth="0" marginheight="0" scrolling="no" frameborder="0" style="border:0; vertical-align:bottom;margin:0;" allowtransparency="true"></iframe></div></div>
<div class="blank5 clearfix"></div>
<div class="clearfix mt10" id="tonglan1"><div id="txtlink"><ul><li><a href="http://www.jsll.me/" target="_blank"><span style="color:red;">低价出售流量10000IP只需8元</span></a></li><li><a href="http://click.aliyun.com/m/2160/" target="_blank"><span style="color:red;">【阿里云SSD云盘】速度行业领先</span></a></li><li><a href="http://www.99-idc.com/" target="_blank"><span style="color:red;">16核独服350/固态盘独服288/创梦网络</span></a></li><li><a href="http://www.huidouyun.com/?jbzj" target="_blank"><span style="color:red;">独立ip日付vps云主机租用只需1.9元 </span></a></li><li><a href="http://js.50bang.org/?formType=7858" target="_blank"><span style="color:blue;">装软件赚钱，每台电脑秒赚6.3元</span></a></li><li><a href="http://idc.jb51.net/" target="_blank"><span style="color:blue;">脚本之家云服务器、百独服务器托管</span></a></li><li><a href="http://www.vzidc.com/" target="_blank"><span style="color:blue;">微子网络 湛江双线高防 抗15G 700元起</span></a></li><li><a href="http://youhui.jb51.net/?txt" target="_blank"><span style="color:blue;">500家知名商城加盟，最高购物返利63%</span></a></li><li><a href="http://www.021.net/" target="_blank"><span style="color:red;">众生网络 基于云计算的互联网基础服务运营商</span></a></li><li><a href="http://www.tuidc.com/" target="_blank"><span style="color:red;">服务器租用/托管-域名空间/认准腾佑科技</span></a></li><li><a href="http://www.enkj.com/special/20160315/" target="_blank"><span style="color:red;">BGP四线 亿恩1U服务器托管3999元/年</span></a></li><li><a href="http://www.jjidc.com/" target="_blank"><span style="color:red;">九九数据 ― 工信部认可正规资质IDC接入商</span></a></li><li><a href="http://www.33ip.com/" target="_blank"><span style="color:blue;">枫信科技-江苏双线10M保证-399/元</span></a></li><li><a href="http://idc.jb51.net/?jb51" target="_blank"><span style="color:blue;">四核15M独享服务器特价188元/月</span></a></li><li><a href="http://www.ssf.cc/" target="_blank"><span style="color:blue;">免备vps20/百独799/双线350/45互联</span></a></li><li><a href="http://idc.jb51.net/" target="_blank"><span style="color:blue;">脚本之家 云服务器、百独服务器托管</span></a></li><li><a href="http://www.139w.com/100m.asp" target="_blank"><span style="color:red;">鼎点网络百兆独享服务器仅需999元</span></a></li><li><a href="http://www.163cdn.com/" target="_blank"><span style="color:red;">免备案国内虚拟主机-163cdn</span></a></li><li><a href="http://www.cyidc.cc/" target="_blank"><span style="color:red;">畅游网络 百独服务器 包跑满 998元</span></a></li><li><a href="http://www.wdw6.com/" target="_blank"><span style="color:red;">服务器租用  199元起</span></a></li></ul><div class="clearfix"></div></div><div class="blank6"></div><div class="topimg"><ul><li><a href="http://www.west.cn/services/CloudHost/?ads=jb512014" target="_blank"><img alt="" src="./scoped_ptr shared_ptr weak_ptr_files/west263_237.gif" width="237" height="60"></a></li><li><a href="http://click.aliyun.com/m/3815/" target="_blank"><img alt="" src="./scoped_ptr shared_ptr weak_ptr_files/aliyun_237.gif" width="237" height="60"></a></li><li><a href="http://www.capitalonline.net/zh-cn/" target="_blank"><img alt="" src="./scoped_ptr shared_ptr weak_ptr_files/sdzx_237.gif" width="237" height="60"></a></li><li><a href="http://www.7e.hk/" target="_blank"><img alt="" src="./scoped_ptr shared_ptr weak_ptr_files/7ehk.gif" width="237" height="60"></a></li></ul></div><div class="blank6"></div><div class="mainlr"><a href="http://click.aliyun.com/m/4194/" target="_blank"><img src="./scoped_ptr shared_ptr weak_ptr_files/aliyun1000.gif" alt="阿里云" width="1000" height="60"></a></div><div class="blank5"></div><div class="mainlr"><a href="http://www.niaoyun.com/#jb51-1-14?utm_source=qudaopc&amp;utm_medium=cpc&amp;utm_campaign=qudao-jb51&amp;utm_content=&amp;utm_term=" target="_blank"><img src="./scoped_ptr shared_ptr weak_ptr_files/niaoyun.gif" alt="小鸟云" width="1000" height="60"></a></div><div class="blank10"></div></div>
</div>

<!--content Star -->
<div id="contents">
 <div class="main clearfix">
      <div class="w690 fl">
      <div class="article-content border">
      <div class="title">
            <h1 class="YaHei">浅析Boost智能指针:scoped_ptr shared_ptr weak_ptr</h1>
            <p>作者：  字体：[<a href="javascript:turnbig()">增加</a> <a href="javascript:turnsmall()">减小</a>] 类型：转载 时间：2013-09-13<a href="http://www.jb51.net/article/41352.htm#comments"> 我要评论</a></p>
        </div>
        <div class="art_desc mt10"><div id="art_demo">虽然通过弱引用指针可以有效的解除循环引用，但这种方式必须在程序员能预见会出现循环引用的情况下才能使用，也可以是说这个仅仅是一种编译期的解决方案，如果程序在运行过程中出现了循环引用，还是会造成内存泄漏的</div></div>
        <div class="lbd clearfix" id="bdctop"><script type="text/javascript">dy("art_up")</script><script type="text/javascript">var cpro_id="u2261530";(window["cproStyleApi"] = window["cproStyleApi"] || {})[cpro_id]={at:"3",rsi0:"680",rsi1:"200",pat:"6",tn:"baiduCustNativeAD",rss1:"#FFFFFF",conBW:"1",adp:"1",ptt:"0",titFF:"%E5%BE%AE%E8%BD%AF%E9%9B%85%E9%BB%91",titFS:"14",rss2:"#000000",titSU:"0",ptbg:"90",piw:"0",pih:"0",ptp:"0"}</script><script src="./scoped_ptr shared_ptr weak_ptr_files/c.js" type="text/javascript"></script><div id="BAIDU_SSP__wrapper_u2261530_0"><iframe id="iframeu2261530_0" src="./scoped_ptr shared_ptr weak_ptr_files/hcom(7).html" width="680" height="200" align="center,center" vspace="0" hspace="0" marginwidth="0" marginheight="0" scrolling="no" frameborder="0" style="border:0; vertical-align:bottom;margin:0;" allowtransparency="true"></iframe></div></div>
        <div id="content">
<p><strong><font style="COLOR: #ff0000">一. scoped_ptr<br></font></strong>boost::scoped_ptr和std::auto_ptr非常类似，是一个简单的智能指针，它能够保证在离开作用域后对象被自动释放。下列代码演示了该指针的基本应用：<br></p><div class="codetitle"><span><a style="CURSOR: pointer" data="73380" class="copybut" id="copybut73380" onclick="doCopy(&#39;code73380&#39;)"><u>复制代码</u></a></span> 代码如下:</div><div class="codebody" id="code73380"><br>#include &lt;string&gt;<br>#include &lt;iostream&gt;<br>#include &lt;boost/scoped_ptr.hpp&gt;<p></p>
<p>class implementation<br>{<br>public:<br>&nbsp;&nbsp;&nbsp; ~implementation() { std::cout &lt;&lt;"destroying implementation\n"; }<br>&nbsp;&nbsp;&nbsp; void do_something() { std::cout &lt;&lt; "did something\n"; }<br>};</p>
<p>void test()<br>{<br>&nbsp;&nbsp;&nbsp; boost::scoped_ptr&lt;implementation&gt; impl(new implementation());<br>&nbsp;&nbsp;&nbsp; impl-&gt;do_something();<br>}</p>
<p>void main()<br>{<br>&nbsp;&nbsp;&nbsp; std::cout&lt;&lt;"Test Begin ... \n";<br>&nbsp;&nbsp;&nbsp; test();<br>&nbsp;&nbsp;&nbsp; std::cout&lt;&lt;"Test End.\n";<br>}<br></p></div><br>该代码的输出结果是：<br><div class="codetitle"><span><a style="CURSOR: pointer" data="65094" class="copybut" id="copybut65094" onclick="doCopy(&#39;code65094&#39;)"><u>复制代码</u></a></span> 代码如下:</div><div class="codebody" id="code65094"><br>Test Begin ...<br>did something<br>destroying implementation<br>Test End.<br></div><br>可以看到：当implementation类离其开impl作用域的时候，会被自动删除，这样就会避免由于忘记手动调用delete而造成内存泄漏了。<p></p>
<p><strong>boost::scoped_ptr特点：<br></strong>boost::scoped_ptr的实现和std::auto_ptr非常类似，都是利用了一个栈上的对象去管理一个堆上的对象，从而使得堆上的对象随着栈上的对象销毁时自动删除。不同的是，boost::scoped_ptr有着更严格的使用限制――不能拷贝。这就意味着：boost::scoped_ptr指针是不能转换其所有权的。</p>
<p><font style="BACKGROUND-COLOR: #ffff00">1.不能转换所有权<br></font>boost::scoped_ptr所管理的对象生命周期仅仅局限于一个区间（该指针所在的"{}"之间），无法传到区间之外，这就意味着boost::scoped_ptr对象是不能作为函数的返回值的（std::auto_ptr可以）。</p>
<p><font style="BACKGROUND-COLOR: #ffff00">2.不能共享所有权<br></font>这点和std::auto_ptr类似。这个特点一方面使得该指针简单易用。另一方面也造成了功能的薄弱――不能用于stl的容器中。</p>
<p><font style="BACKGROUND-COLOR: #ffff00">3.不能用于管理数组对象<br></font>由于boost::scoped_ptr是通过delete来删除所管理对象的，而数组对象必须通过deletep[]来删除，因此boost::scoped_ptr是不能管理数组对象的，如果要管理数组对象需要使用boost::scoped_array类。<br><strong><br>boost::scoped_ptr的常用操作：<br></strong>可以简化为如下形式：<br></p><div class="codetitle"><span><a style="CURSOR: pointer" data="43068" class="copybut" id="copybut43068" onclick="doCopy(&#39;code43068&#39;)"><u>复制代码</u></a></span> 代码如下:</div><div class="codebody" id="code43068"><br>namespace boost {<p></p>
<p>&nbsp;&nbsp;&nbsp; template&lt;typename T&gt; class scoped_ptr : noncopyable {<br>&nbsp;&nbsp;&nbsp; public:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; explicit scoped_ptr(T* p = 0); <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ~scoped_ptr(); </p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; void reset(T* p = 0); </p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; T&amp; operator*() const; <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; T* operator-&gt;() const; <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; T* get() const; </p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; void swap(scoped_ptr&amp; b); <br>&nbsp;&nbsp;&nbsp; };</p>
<p>&nbsp;&nbsp;&nbsp; template&lt;typename T&gt; <br>&nbsp;&nbsp;&nbsp; void swap(scoped_ptr&lt;T&gt; &amp; a, scoped_ptr&lt;T&gt; &amp; b); <br>}<br></p></div><br>它的常用操作如下：<br><br>
<table style="BORDER-BOTTOM: rgb(192,192,192) 1px solid; BORDER-LEFT: rgb(192,192,192) 1px solid; BORDER-COLLAPSE: collapse; BORDER-TOP: rgb(192,192,192) 1px solid; BORDER-RIGHT: rgb(192,192,192) 1px solid" border="0">
<tbody valign="top">
<tr>
<td style="BORDER-BOTTOM: rgb(128,100,162) 1pt solid; PADDING-BOTTOM: 3px; LINE-HEIGHT: 1.5; BORDER-RIGHT-STYLE: none; PADDING-LEFT: 7px; PADDING-RIGHT: 7px; BORDER-COLLAPSE: collapse; FONT-FAMILY: Verdana, Helvetica, Arial; BORDER-LEFT-STYLE: none; WORD-BREAK: normal !important; BORDER-TOP: rgb(128,100,162) 1pt solid; PADDING-TOP: 3px">
<p style="TEXT-ALIGN: justify; MARGIN: 0px auto 10px"><span style="COLOR: rgb(95,73,122); FONT-SIZE: 9pt"><span>成员函数</span></span></p></td>
<td style="BORDER-BOTTOM: rgb(128,100,162) 1pt solid; PADDING-BOTTOM: 3px; LINE-HEIGHT: 1.5; BORDER-RIGHT-STYLE: none; PADDING-LEFT: 7px; PADDING-RIGHT: 7px; BORDER-COLLAPSE: collapse; FONT-FAMILY: Verdana, Helvetica, Arial; BORDER-LEFT-STYLE: none; WORD-BREAK: normal !important; BORDER-TOP: rgb(128,100,162) 1pt solid; PADDING-TOP: 3px">
<p style="TEXT-ALIGN: justify; MARGIN: 0px auto 10px"><span style="COLOR: rgb(95,73,122); FONT-SIZE: 9pt"><span>功能</span></span></p></td></tr>
<tr style="BACKGROUND-COLOR: rgb(223,216,232)">
<td style="BORDER-BOTTOM: rgb(192,192,192) 1px solid; PADDING-BOTTOM: 3px; LINE-HEIGHT: 1.5; BORDER-RIGHT-STYLE: none; PADDING-LEFT: 7px; PADDING-RIGHT: 7px; BORDER-COLLAPSE: collapse; FONT-FAMILY: Verdana, Helvetica, Arial; BORDER-LEFT-STYLE: none; WORD-BREAK: normal !important; BORDER-TOP: rgb(192,192,192) 1px solid; PADDING-TOP: 3px">
<p style="TEXT-ALIGN: justify; MARGIN: 0px auto 10px"><span style="FONT-FAMILY: &#39;Courier Std&#39;; FONT-SIZE: 9pt"><span><span style="COLOR: blue">operator</span><span style="COLOR: rgb(95,73,122)">*()</span></span></span></p></td>
<td style="BORDER-BOTTOM: rgb(192,192,192) 1px solid; PADDING-BOTTOM: 3px; LINE-HEIGHT: 1.5; BORDER-RIGHT-STYLE: none; PADDING-LEFT: 7px; PADDING-RIGHT: 7px; BORDER-COLLAPSE: collapse; FONT-FAMILY: Verdana, Helvetica, Arial; BORDER-LEFT-STYLE: none; WORD-BREAK: normal !important; BORDER-TOP: rgb(192,192,192) 1px solid; PADDING-TOP: 3px">
<p style="TEXT-ALIGN: justify; MARGIN: 0px auto 10px"><span style="COLOR: rgb(95,73,122); FONT-SIZE: 9pt">以引用的形式访问所管理的对象的成员</span></p></td></tr>
<tr>
<td style="BORDER-BOTTOM: rgb(192,192,192) 1px solid; BORDER-LEFT: rgb(192,192,192) 1px solid; PADDING-BOTTOM: 3px; LINE-HEIGHT: 1.5; PADDING-LEFT: 7px; PADDING-RIGHT: 7px; BORDER-COLLAPSE: collapse; FONT-FAMILY: Verdana, Helvetica, Arial; WORD-BREAK: normal !important; BORDER-TOP: rgb(192,192,192) 1px solid; BORDER-RIGHT: rgb(192,192,192) 1px solid; PADDING-TOP: 3px">
<p style="TEXT-ALIGN: justify; MARGIN: 0px auto 10px"><span style="FONT-FAMILY: &#39;Courier Std&#39;; FONT-SIZE: 9pt"><span><span style="COLOR: blue">operator</span><span style="COLOR: rgb(95,73,122)">-&gt;()</span></span></span></p></td>
<td style="BORDER-BOTTOM: rgb(192,192,192) 1px solid; BORDER-LEFT: rgb(192,192,192) 1px solid; PADDING-BOTTOM: 3px; LINE-HEIGHT: 1.5; PADDING-LEFT: 7px; PADDING-RIGHT: 7px; BORDER-COLLAPSE: collapse; FONT-FAMILY: Verdana, Helvetica, Arial; WORD-BREAK: normal !important; BORDER-TOP: rgb(192,192,192) 1px solid; BORDER-RIGHT: rgb(192,192,192) 1px solid; PADDING-TOP: 3px">
<p style="TEXT-ALIGN: justify; MARGIN: 0px auto 10px"><span style="COLOR: rgb(95,73,122); FONT-SIZE: 9pt">以指针的形式访问所管理的对象的成员</span></p></td></tr>
<tr style="BACKGROUND-COLOR: rgb(223,216,232)">
<td style="BORDER-BOTTOM: rgb(192,192,192) 1px solid; PADDING-BOTTOM: 3px; LINE-HEIGHT: 1.5; BORDER-RIGHT-STYLE: none; PADDING-LEFT: 7px; PADDING-RIGHT: 7px; BORDER-COLLAPSE: collapse; FONT-FAMILY: Verdana, Helvetica, Arial; BORDER-LEFT-STYLE: none; WORD-BREAK: normal !important; BORDER-TOP: rgb(192,192,192) 1px solid; PADDING-TOP: 3px">
<p style="TEXT-ALIGN: justify; MARGIN: 0px auto 10px"><span style="FONT-FAMILY: &#39;Courier Std&#39;; COLOR: rgb(95,73,122); FONT-SIZE: 9pt"><span>get()</span></span></p></td>
<td style="BORDER-BOTTOM: rgb(192,192,192) 1px solid; PADDING-BOTTOM: 3px; LINE-HEIGHT: 1.5; BORDER-RIGHT-STYLE: none; PADDING-LEFT: 7px; PADDING-RIGHT: 7px; BORDER-COLLAPSE: collapse; FONT-FAMILY: Verdana, Helvetica, Arial; BORDER-LEFT-STYLE: none; WORD-BREAK: normal !important; BORDER-TOP: rgb(192,192,192) 1px solid; PADDING-TOP: 3px">
<p style="TEXT-ALIGN: justify; MARGIN: 0px auto 10px"><span style="COLOR: rgb(95,73,122); FONT-SIZE: 9pt">释放所管理的对象，管理另外一个对象</span></p></td></tr>
<tr>
<td style="BORDER-BOTTOM: rgb(128,100,162) 1pt solid; BORDER-LEFT: rgb(192,192,192) 1px solid; PADDING-BOTTOM: 3px; LINE-HEIGHT: 1.5; PADDING-LEFT: 7px; PADDING-RIGHT: 7px; BORDER-COLLAPSE: collapse; FONT-FAMILY: Verdana, Helvetica, Arial; WORD-BREAK: normal !important; BORDER-TOP: rgb(192,192,192) 1px solid; BORDER-RIGHT: rgb(192,192,192) 1px solid; PADDING-TOP: 3px">
<p style="TEXT-ALIGN: justify; MARGIN: 0px auto 10px"><span style="FONT-FAMILY: &#39;Courier Std&#39;; COLOR: rgb(95,73,122); FONT-SIZE: 9pt"><span>swap(scoped_ptr&amp; b)</span></span></p></td>
<td style="BORDER-BOTTOM: rgb(128,100,162) 1pt solid; BORDER-LEFT: rgb(192,192,192) 1px solid; PADDING-BOTTOM: 3px; LINE-HEIGHT: 1.5; PADDING-LEFT: 7px; PADDING-RIGHT: 7px; BORDER-COLLAPSE: collapse; FONT-FAMILY: Verdana, Helvetica, Arial; WORD-BREAK: normal !important; BORDER-TOP: rgb(192,192,192) 1px solid; BORDER-RIGHT: rgb(192,192,192) 1px solid; PADDING-TOP: 3px">
<p style="TEXT-ALIGN: justify; MARGIN: 0px auto 10px"><span style="COLOR: rgb(95,73,122); FONT-SIZE: 9pt">交换两个boost::scoped_ptr管理的对象</span></p></td></tr></tbody></table><br><br>下列测试代码演示了这些功能函数的基本使用方法。<br><div class="codetitle"><span><a style="CURSOR: pointer" data="82589" class="copybut" id="copybut82589" onclick="doCopy(&#39;code82589&#39;)"><u>复制代码</u></a></span> 代码如下:</div><div class="codebody" id="code82589"><br>#include &lt;string&gt;<br>#include &lt;iostream&gt;<p></p>
<p>#include &lt;boost/scoped_ptr.hpp&gt;<br>#include &lt;boost/scoped_array.hpp&gt;</p>
<p>#include &lt;boost/config.hpp&gt;<br>#include &lt;boost/detail/lightweight_test.hpp&gt;</p>
<p>void test()<br>{<br>&nbsp;&nbsp;&nbsp; // test scoped_ptr with a built-in type<br>&nbsp;&nbsp;&nbsp; long * lp = new long;<br>&nbsp;&nbsp;&nbsp; boost::scoped_ptr&lt;long&gt; sp ( lp );<br>&nbsp;&nbsp;&nbsp; BOOST_TEST( sp.get() == lp );<br>&nbsp;&nbsp;&nbsp; BOOST_TEST( lp == sp.get() );<br>&nbsp;&nbsp;&nbsp; BOOST_TEST( &amp;*sp == lp );</p>
<p>&nbsp;&nbsp;&nbsp; *sp = 1234568901L;<br>&nbsp;&nbsp;&nbsp; BOOST_TEST( *sp == 1234568901L );<br>&nbsp;&nbsp;&nbsp; BOOST_TEST( *lp == 1234568901L );</p>
<p>&nbsp;&nbsp;&nbsp; long * lp2 = new long;<br>&nbsp;&nbsp;&nbsp; boost::scoped_ptr&lt;long&gt; sp2 ( lp2 );</p>
<p>&nbsp;&nbsp;&nbsp; sp.swap(sp2);<br>&nbsp;&nbsp;&nbsp; BOOST_TEST( sp.get() == lp2 );<br>&nbsp;&nbsp;&nbsp; BOOST_TEST( sp2.get() == lp );</p>
<p>&nbsp;&nbsp;&nbsp; sp.reset(NULL);<br>&nbsp;&nbsp;&nbsp; BOOST_TEST( sp.get() == NULL );</p>
<p>}</p>
<p>void main()<br>{<br>&nbsp;&nbsp;&nbsp; test();<br>}<br></p></div><br>boost::scoped_ptr和std::auto_ptr的选取：<br>boost::scoped_ptr和std::auto_ptr的功能和操作都非常类似，如何在他们之间选取取决于是否需要转移所管理的对象的所有权（如是否需要作为函数的返回值）。如果没有这个需要的话，大可以使用boost::scoped_ptr，让编译器来进行更严格的检查，来发现一些不正确的赋值操作。<p></p>
<p><strong><font style="COLOR: #ff0000">二. shared_ptr<br></font></strong>boost::scoped_ptr虽然简单易用，但它不能共享所有权的特性却大大限制了其使用范围，而boost::shared_ptr可以解决这一局限。顾名思义，boost::shared_ptr是可以共享所有权的智能指针，首先让我们通过一个例子看看它的基本用法：<br></p><div class="codetitle"><span><a style="CURSOR: pointer" data="64026" class="copybut" id="copybut64026" onclick="doCopy(&#39;code64026&#39;)"><u>复制代码</u></a></span> 代码如下:</div><div class="codebody" id="code64026"><br>#include &lt;string&gt;<br>#include &lt;iostream&gt;<br>#include &lt;boost/shared_ptr.hpp&gt;<p></p>
<p>class implementation<br>{<br>public:<br>&nbsp;&nbsp;&nbsp; ~implementation() { std::cout &lt;&lt;"destroying implementation\n"; }<br>&nbsp;&nbsp;&nbsp; void do_something() { std::cout &lt;&lt; "did something\n"; }<br>};</p>
<p>void test()<br>{<br>&nbsp;&nbsp;&nbsp; boost::shared_ptr&lt;implementation&gt; sp1(new implementation());<br>&nbsp;&nbsp;&nbsp; std::cout&lt;&lt;"The Sample now has "&lt;&lt;sp1.use_count()&lt;&lt;" references\n";</p>
<p>&nbsp;&nbsp;&nbsp; boost::shared_ptr&lt;implementation&gt; sp2 = sp1;<br>&nbsp;&nbsp;&nbsp; std::cout&lt;&lt;"The Sample now has "&lt;&lt;sp2.use_count()&lt;&lt;" references\n";<br><br>&nbsp;&nbsp;&nbsp; sp1.reset();<br>&nbsp;&nbsp;&nbsp; std::cout&lt;&lt;"After Reset sp1. The Sample now has "&lt;&lt;sp2.use_count()&lt;&lt;" references\n";</p>
<p>&nbsp;&nbsp;&nbsp; sp2.reset();<br>&nbsp;&nbsp;&nbsp; std::cout&lt;&lt;"After Reset sp2.\n";<br>}</p>
<p>void main()<br>{<br>&nbsp;&nbsp;&nbsp; test();<br>}<br></p></div><br>该程序的输出结果如下：<br><div class="codetitle"><span><a style="CURSOR: pointer" data="46272" class="copybut" id="copybut46272" onclick="doCopy(&#39;code46272&#39;)"><u>复制代码</u></a></span> 代码如下:</div><div class="codebody" id="code46272"><br>The Sample now has 1 references<br>The Sample now has 2 references<br>After Reset sp1. The Sample now has 1 references<br>destroying implementation<br>After Reset sp2.<br></div><br>可以看到，boost::shared_ptr指针sp1和sp2同时拥有了implementation对象的访问权限，且当sp1和sp2都释放对该对象的所有权时，其所管理的的对象的内存才被自动释放。在共享对象的访问权限同时，也实现了其内存的自动管理。<p></p>
<p><strong>boost::shared_ptr的内存管理机制：<br></strong>boost::shared_ptr的管理机制其实并不复杂，就是对所管理的对象进行了引用计数，当新增一个boost::shared_ptr对该对象进行管理时，就将该对象的引用计数加一；减少一个boost::shared_ptr对该对象进行管理时，就将该对象的引用计数减一，如果该对象的引用计数为0的时候，说明没有任何指针对其管理，才调用delete释放其所占的内存。</p>
<p><font style="BACKGROUND-COLOR: #ffcc99">上面的那个例子可以的图示如下：</font></p>
<p>1.sp1对implementation对象进行管理，其引用计数为1 </p>
<p>2.增加sp2对implementation对象进行管理，其引用计数增加为2 </p>
<p>3.sp1释放对implementation对象进行管理，其引用计数变为1 </p>
<p>4.sp2释放对implementation对象进行管理，其引用计数变为0，该对象被自动删除 </p>
<p><strong>boost::shared_ptr的特点：<br></strong>和前面介绍的boost::scoped_ptr相比，boost::shared_ptr可以共享对象的所有权，因此其使用范围基本上没有什么限制（还是有一些需要遵循的使用规则，下文中介绍），自然也可以使用在stl的容器中。另外它还是线程安全的，这点在多线程程序中也非常重要。</p>
<p><strong>boost::shared_ptr的使用规则：<br></strong>boost::shared_ptr并不是绝对安全，下面几条规则能使我们更加安全的使用boost::shared_ptr：</p>
<p>1.避免对shared_ptr所管理的对象的直接内存管理操作，以免造成该对象的重释放<br>2.shared_ptr并不能对循环引用的对象内存自动管理（这点是其它各种引用计数管理内存方式的通病）。<br>3.不要构造一个临时的shared_ptr作为函数的参数。</p>
<p><strong>如下列代码则可能导致内存泄漏：<br></strong></p><div class="codetitle"><span><a style="CURSOR: pointer" data="72976" class="copybut" id="copybut72976" onclick="doCopy(&#39;code72976&#39;)"><u>复制代码</u></a></span> 代码如下:</div><div class="codebody" id="code72976"><br>void test()<br>{<br>&nbsp;&nbsp;&nbsp; foo(boost::shared_ptr&lt;implementation&gt;(new&nbsp;&nbsp;&nbsp; implementation()),g());<br>}<br>正确的用法为：<br>void test()<br>{<br>&nbsp;&nbsp;&nbsp; boost::shared_ptr&lt;implementation&gt; sp&nbsp;&nbsp;&nbsp; (new implementation());<br>&nbsp;&nbsp;&nbsp; foo(sp,g());<br>}<br></div><br><strong><font style="COLOR: #ff0000">三.&nbsp; weak_ptr</font></strong><p></p>
<p><strong>循环引用：<br></strong>引用计数是一种便利的内存管理机制，但它有一个很大的缺点，那就是不能管理循环引用的对象。一个简单的例子如下：<br></p><div class="codetitle"><span><a style="CURSOR: pointer" data="92866" class="copybut" id="copybut92866" onclick="doCopy(&#39;code92866&#39;)"><u>复制代码</u></a></span> 代码如下:</div><div class="codebody" id="code92866"><br>#include &lt;string&gt;<br>#include &lt;iostream&gt;<br>#include &lt;boost/shared_ptr.hpp&gt;<br>#include &lt;boost/weak_ptr.hpp&gt;<p></p>
<p>class parent;<br>class children;</p>
<p>typedef boost::shared_ptr&lt;parent&gt; parent_ptr;<br>typedef boost::shared_ptr&lt;children&gt; children_ptr;</p>
<p>class parent<br>{<br>public:<br>&nbsp;&nbsp;&nbsp; ~parent() { std::cout &lt;&lt;"destroying parent\n"; }</p>
<p>public:<br>&nbsp;&nbsp;&nbsp; children_ptr children;<br>};</p>
<p>class children<br>{<br>public:<br>&nbsp;&nbsp;&nbsp; ~children() { std::cout &lt;&lt;"destroying children\n"; }</p>
<p>public:<br>&nbsp;&nbsp;&nbsp; parent_ptr parent;<br>};</p>
<p><br>void test()<br>{<br>&nbsp;&nbsp;&nbsp; parent_ptr father(new parent());<br>&nbsp;&nbsp;&nbsp; children_ptr son(new children);</p>
<p>&nbsp;&nbsp;&nbsp; father-&gt;children = son;<br>&nbsp;&nbsp;&nbsp; son-&gt;parent = father;<br>}</p>
<p>void main()<br>{<br>&nbsp;&nbsp;&nbsp; std::cout&lt;&lt;"begin test...\n";<br>&nbsp;&nbsp;&nbsp; test();<br>&nbsp;&nbsp;&nbsp; std::cout&lt;&lt;"end test.\n";<br>}<br></p></div><br>运行该程序可以看到，即使退出了test函数后，由于parent和children对象互相引用，它们的引用计数都是1，不能自动释放，并且此时这两个对象再无法访问到。这就引起了c++中那臭名昭著的内存泄漏。<p></p>
<p><font style="BACKGROUND-COLOR: #ffcc99">一般来讲，解除这种循环引用有下面有三种可行的方法：<br></font>1.当只剩下最后一个引用的时候需要手动打破循环引用释放对象。<br>2.当parent的生存期超过children的生存期的时候，children改为使用一个普通指针指向parent。<br>3.使用弱引用的智能指针打破这种循环引用。</p>
<p>虽然这三种方法都可行，但方法1和方法2都需要程序员手动控制，麻烦且容易出错。这里主要介绍一下第三种方法和boost中的弱引用的智能指针boost::weak_ptr。</p>
<p><strong>强引用和弱引用<br></strong>一个强引用当被引用的对象活着的话，这个引用也存在（就是说，当至少有一个强引用，那么这个对象就不能被释放）。boost::share_ptr就是强引用。</p>
<p>相对而言，弱引用当引用的对象活着的时候不一定存在。仅仅是当它存在的时候的一个引用。弱引用并不修改该对象的引用计数，这意味这弱引用它并不对对象的内存进行管理，在功能上类似于普通指针，然而一个比较大的区别是，弱引用能检测到所管理的对象是否已经被释放，从而避免访问非法内存。<br></p><div class="codetitle"><span><a style="CURSOR: pointer" data="59754" class="copybut" id="copybut59754" onclick="doCopy(&#39;code59754&#39;)"><u>复制代码</u></a></span> 代码如下:</div><div class="codebody" id="code59754"><br>boost::weak_ptr<p></p>
<p>boost::weak_ptr&lt;T&gt;是boost提供的一个弱引用的智能指针，它的声明可以简化如下：</p>
<p>namespace boost {</p>
<p>&nbsp;&nbsp;&nbsp; template&lt;typename T&gt; class weak_ptr {<br>&nbsp;&nbsp;&nbsp; public:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; template &lt;typename Y&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; weak_ptr(const shared_ptr&lt;Y&gt;&amp; r);</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; weak_ptr(const weak_ptr&amp; r);</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ~weak_ptr();</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; T* get() const; <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; bool expired() const; <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; shared_ptr&lt;T&gt; lock() const;<br>&nbsp;&nbsp;&nbsp; }; <br>}<br></p></div><br>可以看到，boost::weak_ptr必须从一个boost::share_ptr或另一个boost::weak_ptr转换而来，这也说明，进行该对象的内存管理的是那个强引用的boost::share_ptr。boost::weak_ptr只是提供了对管理对象的一个访问手段。<p></p>
<p>boost::weak_ptr除了对所管理对象的基本访问功能（通过get()函数）外，还有两个常用的功能函数：expired()用于检测所管理的对象是否已经释放；lock()用于获取所管理的对象的强引用指针。</p>
<p><strong>通过boost::weak_ptr来打破循环引用<br></strong>由于弱引用不更改引用计数，类似普通指针，只要把循环引用的一方使用弱引用，即可解除循环引用。对于上面的那个例子来说，只要把children的定义改为如下方式，即可解除循环引用：<br></p><div class="codetitle"><span><a style="CURSOR: pointer" data="59090" class="copybut" id="copybut59090" onclick="doCopy(&#39;code59090&#39;)"><u>复制代码</u></a></span> 代码如下:</div><div class="codebody" id="code59090"><br>class children<br>{<br>public:<br>&nbsp;&nbsp;&nbsp; ~children() { std::cout &lt;&lt;"destroying children\n"; }<p></p>
<p>public:<br>&nbsp;&nbsp;&nbsp; boost::weak_ptr&lt;parent&gt; parent;<br>};<br></p></div><br>最后值得一提的是,虽然通过弱引用指针可以有效的解除循环引用，但这种方式必须在程序员能预见会出现循环引用的情况下才能使用，也可以是说这个仅仅是一种编译期的解决方案，如果程序在运行过程中出现了循环引用，还是会造成内存泄漏的。因此，不要认为只要使用了智能指针便能杜绝内存泄漏。毕竟，对于C++来说，由于没有垃圾回收机制，内存泄漏对每一个程序员来说都是一个非常头痛的问题。<p></p>

</div><!--endmain-->
<div class="art_xg">
<h4>您可能感兴趣的文章:</h4><ul><li><a href="http://www.jb51.net/article/32235.htm" title="C++中智能指针如何设计和使用" target="_blank">C++中智能指针如何设计和使用</a></li><li><a href="http://www.jb51.net/article/39793.htm" title="C++ 智能指针深入解析" target="_blank">C++ 智能指针深入解析</a></li><li><a href="http://www.jb51.net/article/52444.htm" title="C++智能指针实例详解" target="_blank">C++智能指针实例详解</a></li><li><a href="http://www.jb51.net/article/75324.htm" title="C++智能指针读书笔记" target="_blank">C++智能指针读书笔记</a></li></ul>
</div>
<div id="bot_ad" class="lbd clearfix">
<script type="text/javascript">
var cpro_id="u776243";
(window["cproStyleApi"] = window["cproStyleApi"] || {})[cpro_id]={at:"3",rsi0:"650",rsi1:"250",pat:"1",tn:"baiduCustNativeAD",rss1:"#FFFFFF",conBW:"0",adp:"1",ptt:"0",titFF:"%E5%BE%AE%E8%BD%AF%E9%9B%85%E9%BB%91",titFS:"14",rss2:"#000000",titSU:"0",tft:"0",tlt:"1",ptbg:"90",piw:"0",pih:"0",ptp:"0"}
</script>
<script src="./scoped_ptr shared_ptr weak_ptr_files/c.js" type="text/javascript"></script><div id="BAIDU_SSP__wrapper_u776243_0"><iframe id="iframeu776243_0" src="./scoped_ptr shared_ptr weak_ptr_files/hcom(8).html" width="650" height="250" align="center,center" vspace="0" hspace="0" marginwidth="0" marginheight="0" scrolling="no" frameborder="0" style="border:0; vertical-align:bottom;margin:0;" allowtransparency="true"></iframe></div>
</div>
<div id="shoucang">
    <div class="bdsharebuttonbox bdshare-button-style0-16" data-bd-bind="1459177140668"><a class="bds_more" href="http://share.baidu.com/code#" data-cmd="more"></a><a class="bds_qzone" title="分享到QQ空间" href="http://share.baidu.com/code#" data-cmd="qzone"></a><a class="bds_tsina" title="分享到新浪微博" href="http://share.baidu.com/code#" data-cmd="tsina"></a><a class="bds_tqq" title="分享到腾讯微博" href="http://share.baidu.com/code#" data-cmd="tqq"></a><a class="bds_renren" title="分享到人人网" href="http://share.baidu.com/code#" data-cmd="renren"></a><a class="bds_weixin" title="分享到微信" href="http://share.baidu.com/code#" data-cmd="weixin"></a></div>
</div>
<div class="tags mt10">
<strong>Tags：</strong><a href="http://img.jb51.net/tag/scoped+ptr/1.htm" target="_blank" title="搜索关于scoped ptr的文章">scoped ptr</a> <a href="http://img.jb51.net/tag/shared+ptr/1.htm" target="_blank" title="搜索关于shared ptr的文章">shared ptr</a> <a href="http://img.jb51.net/tag/weak+ptr/1.htm" target="_blank" title="搜索关于weak ptr的文章">weak ptr</a> 
</div>
<div class="relatedarticle clearfix mt5">
<h2>相关文章</h2>
<ul><li><span>2014-04-04</span><a href="http://www.jb51.net/article/48617.htm" title="c语言指针之二级指针示例" target="_blank">c语言指针之二级指针示例</a></li><li><span>2013-11-11</span><a href="http://www.jb51.net/article/43744.htm" title="C语言切割多层字符串(strtok_r strtok使用方法)" target="_blank">C语言切割多层字符串(strtok_r strtok使用方法)</a></li><li><span>2015-08-08</span><a href="http://www.jb51.net/article/70740.htm" title="浅析C++标准库元组（tuple）源码" target="_blank">浅析C++标准库元组（tuple）源码</a></li><li><span>2015-10-10</span><a href="http://www.jb51.net/article/73589.htm" title="深入浅析STL vector用法" target="_blank">深入浅析STL vector用法</a></li><li><span>2014-10-10</span><a href="http://www.jb51.net/article/56035.htm" title="C++线程同步实例分析" target="_blank">C++线程同步实例分析</a></li><li><span>2013-03-03</span><a href="http://www.jb51.net/article/34710.htm" title="新旧MFC版本实现CEdit透明的2种方法的实例代码" target="_blank">新旧MFC版本实现CEdit透明的2种方法的实例代码</a></li><li><span>2013-07-07</span><a href="http://www.jb51.net/article/39858.htm" title="linux c 获得当前进程的进程名和执行路径(示例)" target="_blank">linux c 获得当前进程的进程名和执行路径(示例)</a></li><li><span>2015-01-01</span><a href="http://www.jb51.net/article/59752.htm" title="C++利用stringstream进行数据类型转换实例" target="_blank">C++利用stringstream进行数据类型转换实例</a></li><li><span>2013-01-01</span><a href="http://www.jb51.net/article/32999.htm" title="VC6.0如何创建以及调用动态链接库实例详解" target="_blank">VC6.0如何创建以及调用动态链接库实例详解</a></li><li><span>2013-09-09</span><a href="http://www.jb51.net/article/41523.htm" title="怎么通过C语言自动生成MAC地址" target="_blank">怎么通过C语言自动生成MAC地址</a></li></ul>
</div>
<div class="lbd clearfix mt5">
<script type="text/javascript">
var cpro_id="u2261530";
(window["cproStyleApi"] = window["cproStyleApi"] || {})[cpro_id]={at:"3",rsi0:"680",rsi1:"200",pat:"6",tn:"baiduCustNativeAD",rss1:"#FFFFFF",conBW:"1",adp:"1",ptt:"0",titFF:"%E5%BE%AE%E8%BD%AF%E9%9B%85%E9%BB%91",titFS:"14",rss2:"#000000",titSU:"0",ptbg:"90",piw:"0",pih:"0",ptp:"0"}
</script>
<script src="./scoped_ptr shared_ptr weak_ptr_files/c.js" type="text/javascript"></script><div id="BAIDU_SSP__wrapper_u2261530_1"><iframe id="iframeu2261530_1" src="./scoped_ptr shared_ptr weak_ptr_files/hcom(9).html" width="680" height="200" align="center,center" vspace="0" hspace="0" marginwidth="0" marginheight="0" scrolling="no" frameborder="0" style="border:0; vertical-align:bottom;margin:0;" allowtransparency="true"></iframe></div>
</div>
<a href="http://www.jb51.net/article/41352.htm#comments"></a>
<div id="comments">
<h2>最新评论</h2>
<div class="pd5"><div id="SOHUCS" sid="art_41352" style="width: 100%; height: auto;"><div id="SOHU_MAIN"><div id="SOHU-comment-main" class="sohu-comment-wrapper"><div id="article_info_sohu">        <div class="reset-g clear-g section-title-w  section-title-logoutStyle">
            <div class="title-join-w">
                <div class="join-wrap-w join-wrap-b"><strong class="wrap-name-w wrap-name-b">评论</strong><span class="wrap-join-w wrap-join-b">(<em class="join-strong-gw join-strong-bg">0</em><span node-type="involved">人参与</span><i class="gap-b">，</i><em class="join-strong-gw join-strong-bg">0</em><span node-type="comments">条评论</span>)</span></div>
            </div>
            <div class="title-user-w">
                <div node-type="sohu-pact" class="title-link-w" style="display: none;"><a href="http://zt.pinglun.sohu.com/s2014/sljyhgy/index.shtml" target="_blank">搜狐“我来说两句”用户公约</a></div>
            </div>
        </div>
        </div><div id="login_sohu"></div><div id="comment_sohu"><div node-type="cbox-wrapper" class="reset-g section-cbox-w"><div style="width:1px;height:1px;overflow:hidden;"><img src="./scoped_ptr shared_ptr weak_ptr_files/vcode.jpg" style="visibility:hidden;width:1px;height:1px;"></div><div class="clear-g cbox-block-w">
            <div class="block-head-w">
                <div class="head-img-w">
                                        <a node-type="user-avatar" href="javascript:void(0)" target="_self"><img src="./scoped_ptr shared_ptr weak_ptr_files/pic42_null.gif" onerror="SOHUCS.isImgErr(this)" width="42" height="42" alt=""></a>
                    </div>
                <!--
                -->
            </div>
        <div class="block-post-w block-post-default-e"><div class="post-wrap-w post-wrap-b"><div class="wrap-area-w"><div class="area-textarea-w" style="position:relative;zoom:1;z-index:9;"><textarea name="" class="textarea-fw textarea-bf">来说两句吧...</textarea></div></div><div class="clear-g wrap-action-w wrap-action-b"><div class="action-function-w action-function-b relative-z-w"><ul class="clear-g"><li class="function-face-w"><a href="javascript:void(0)" class="effect-w" title="表情"><i class="face-b"></i></a></li><li class="function-uploadimg-w"><a href="javascript:void(0)" class="effect-w" title="上传图片"><i class="uploadimg-b"></i></a><div class="uploadimg-file-w"><input class="file-fw" id="img_upload" name="file" type="file" accept="image/*"></div><div class="img-btn-cover" style="width:40px;height:40px;margin-top:-40px;z-index:-1;position: relative;"></div></li><!--<li class="function-at-w"><a href="javascript:void(0)" class="effect-w"><i class="at-b"></i></a></li>--></ul></div><div class="clear-g action-issue-w"><div class="issue-btn-w"><a href="javascript:void(0)"><button class="btn-fw btn-bf btn-fw-main">发布</button></a></div></div></div></div>
                                    <div node-type="login-list" class="post-login-w">
                <ul class="clear-g">
                                                            <li style="display:block">
                        <div class="login-wrap-w login-wrap-b">
                            <a data-key="sina" target="_self" href="javascript:;" title="新浪微博" alt="新浪微博">
                                <span class="wrap-icon-w icon30-sina-b"></span><span class="wrap-name-w wrap-name-b">微博登录</span>
                            </a>
                        </div>
                    </li>
                                        <li style="display:block">
                        <div class="login-wrap-w login-wrap-b">
                            <a data-key="qq" target="_self" href="javascript:;" title="QQ" alt="QQ">
                                <span class="wrap-icon-w icon30-qq-b"></span><span class="wrap-name-w wrap-name-b">QQ登录</span>
                            </a>
                        </div>
                    </li>
                                        <li>
                        <div class="login-wrap-w login-wrap-b login-wrap-phone-b">
                            <a data-key="phone" target="_self" href="javascript:void(0)">
                                <span class="wrap-icon-w icon30-phone-b"></span><span class="wrap-name-w wrap-name-b">手机登录</span>
                            </a>
                        </div>
                    </li>
                    </ul>
            </div>
            </div></div><div node-type="prompt-no-privilege" class="cbox-prompt-w" style="display: none;">
            <span class="prompt-empty-w prompt-empty-b">等级不够，发表评论升至指定级别才能获得该特权。详情请参见<a node-type="privilege-intro" href="javascript:;">等级说明</a>。</span>
        </div></div></div><div id="list_sort_sohu"></div><div id="list_sohu" topicid="560914555">
        <div class="reset-g section-list-w">
            <div class="list-comment-empty-w">
                <div class="empty-prompt-w"><span class="prompt-null-w prompt-null-b">还没有评论，快来抢沙发吧！</span></div>
            </div>
        </div></div><div id="list_hot"></div><div id="page_sohu"></div><div id="more_list_sohu"></div><div id="powerby_sohu">        <div class="reset-g section-service-w">
            <div class="service-wrap-w service-wrap-b"><a node-type="powered-by" href="http://changyan.sohu.com/?from=changyan" target="_blank">Powered by 畅言</a></div>
        </div></div></div></div></div></div>
</div>
      </div><!--endborder-->
      </div><!--end fl-->
      
<div class="w300 fr">
<div class="r300 clearfix" id="r1"><script async="" src="./scoped_ptr shared_ptr weak_ptr_files/adsbygoogle.js"></script><ins class="adsbygoogle" style="display: inline-block; width: 300px; height: 250px;" data-ad-client="ca-pub-6384567588307613" data-ad-slot="2817964327" data-override-format="true" data-page-url="http://www.jb51.net" data-adsbygoogle-status="done"><ins id="aswift_0_expand" style="display:inline-table;border:none;height:250px;margin:0;padding:0;position:relative;visibility:visible;width:300px;background-color:transparent"><ins id="aswift_0_anchor" style="display:block;border:none;height:250px;margin:0;padding:0;position:relative;visibility:visible;width:300px;background-color:transparent"><iframe width="300" height="250" frameborder="0" marginwidth="0" marginheight="0" vspace="0" hspace="0" allowtransparency="true" scrolling="no" allowfullscreen="true" onload="var i=this.id,s=window.google_iframe_oncopy,H=s&amp;&amp;s.handlers,h=H&amp;&amp;H[i],w=this.contentWindow,d;try{d=w.document}catch(e){}if(h&amp;&amp;d&amp;&amp;(!d.body||!d.body.firstChild)){if(h.call){setTimeout(h,0)}else if(h.match){try{h=s.upd(h,i)}catch(e){}w.location.replace(h)}}" id="aswift_0" name="aswift_0" style="left:0;position:absolute;top:0;"></iframe></ins></ins></ins><script>(adsbygoogle = window.adsbygoogle || []).push({});</script></div>
<div class="tabTitleBar mt10 bgf borderTblue">
<div class="borderTnone pb10 YaHei">
<h4 class="blue">大家感兴趣的内容</h4>
<ul class="newsList newList-in">
<li><em class="no1">1</em><a href="http://www.jb51.net/article/33654.htm" title="c语言10个经典小程序" target="_blank">c语言10个经典小程序</a></li><li><em class="no2">2</em><a href="http://www.jb51.net/article/37410.htm" title="C语言字符串操作总结大全(超详细)" target="_blank">C语言字符串操作总结大全(超详细</a></li><li><em class="no3">3</em><a href="http://www.jb51.net/article/38051.htm" title="C语言程序设计50例(经典收藏)" target="_blank">C语言程序设计50例(经典收藏)</a></li><li><em class="no4">4</em><a href="http://www.jb51.net/article/37688.htm" title="C语言文件操作函数大全(超详细)" target="_blank">C语言文件操作函数大全(超详细)</a></li><li><em class="no5">5</em><a href="http://www.jb51.net/article/37456.htm" title="c语言字符数组与字符串的使用详解" target="_blank">c语言字符数组与字符串的使用详解</a></li><li><em class="no6">6</em><a href="http://www.jb51.net/article/37282.htm" title="C语言运算符优先级列表(超详细)" target="_blank">C语言运算符优先级列表(超详细)</a></li><li><em class="no7">7</em><a href="http://www.jb51.net/article/42065.htm" title="C语言/C++中如何产生随机数" target="_blank">C语言/C++中如何产生随机数</a></li><li><em class="no8">8</em><a href="http://www.jb51.net/article/30236.htm" title="c语言连接mysql数据库的实现方法" target="_blank">c语言连接mysql数据库的实现方法</a></li><li><em class="no9">9</em><a href="http://www.jb51.net/article/37319.htm" title="fatal error LNK1104: 无法打开文件“libc.lib”的解决方法" target="_blank">fatal error LNK1104: 无法打开文</a></li><li><em class="no10">10</em><a href="http://www.jb51.net/article/34365.htm" title="c语言冒泡排序法代码" target="_blank">c语言冒泡排序法代码</a></li>
</ul>
</div>
</div>
<div class="r300 clearfix mt10" id="r2"><a href="http://www.capitalonline.net/zh-cn/product/" target="_blank"><img alt="" src="./scoped_ptr shared_ptr weak_ptr_files/sdzx_300.gif" width="300" height="200" data-baiduimageplus-ignore=""></a><div class="blank10"></div><a href="http://click.aliyun.com/m/3697/" target="_blank"><img alt="" src="./scoped_ptr shared_ptr weak_ptr_files/aliyun300.gif" width="300" height="100"></a></div>
<div class="tabTitleBar mt10 bgf borderTblue">
<div class="borderTnone pb10 YaHei">
<h4 class="blue">最近更新的内容</h4>
<ul class="newsListA">
<ul><li><a href="http://www.jb51.net/article/62366.htm" title="C++多线程编程简单实例" target="_blank">C++多线程编程简单实例</a></li><li><a href="http://www.jb51.net/article/55237.htm" title="C语言实现计算树的深度的方法" target="_blank">C语言实现计算树的深度的方法</a></li><li><a href="http://www.jb51.net/article/71187.htm" title="详解C语言中的char数据类型及其与int类型的转换" target="_blank">详解C语言中的char数据类型及其与int类型</a></li><li><a href="http://www.jb51.net/article/49681.htm" title="使用UART与PC通信实现msp430g2553单片机超声波测距示例" target="_blank">使用UART与PC通信实现msp430g2553单片机超</a></li><li><a href="http://www.jb51.net/article/47398.htm" title="队列的动态链式存储实现代码分享" target="_blank">队列的动态链式存储实现代码分享</a></li><li><a href="http://www.jb51.net/article/7211.htm" title="C 语言基础教程(我的C之旅开始了)[七]" target="_blank">C 语言基础教程(我的C之旅开始了)[七]</a></li><li><a href="http://www.jb51.net/article/55410.htm" title="C语言实现socket简单通信实例" target="_blank">C语言实现socket简单通信实例</a></li><li><a href="http://www.jb51.net/article/56621.htm" title="VC使用TerminateProcess结束进程实例" target="_blank">VC使用TerminateProcess结束进程实例</a></li><li><a href="http://www.jb51.net/article/71637.htm" title="用C语言求幂函数和指数函数的方法" target="_blank">用C语言求幂函数和指数函数的方法</a></li><li><a href="http://www.jb51.net/article/10843.htm" title="tc编译的dos程序和vc编译的win32控制台程序的异同" target="_blank">tc编译的dos程序和vc编译的win32控制台程</a></li></ul>
</ul>
</div>
</div>   
<div class="r300 clearfix mt10" id="idctu1"><a href="http://www.021.net/" target="_blank"><img alt="" src="./scoped_ptr shared_ptr weak_ptr_files/zs_300.gif"></a><div class="blank10"></div><a href="http://tuidc.com/" target="_blank"><img src="./scoped_ptr shared_ptr weak_ptr_files/tengyou300.gif" width="300" height="100"></a></div>
<div class="tabTitleBar mt10 bgf borderTblue">
<div class="borderTnone pb10 YaHei">
<h4 class="blue">常用在线小工具</h4>
<ul class="newsListA" id="bctools"><li><a href="http://www.jb51.net/tools/cssyasuo.shtml" target="_blank"><font color="red">CSS在线压缩格式化(中文)</font></a></li><li><a href="http://tools.jb51.net/tools/js_geshihua.asp" target="_blank"><font color="red">JavaScript 格式化整理工具</font></a></li><li><a href="http://www.jb51.net/tools/html-js.htm" target="_blank">HTML/JS互相转换工具</a></li><li><a href="http://www.jb51.net/tools/packer.htm" target="_blank"><font color="red">javascript pack加密压缩工具</font></a></li><li><a href="http://www.jb51.net/tools/jsmin/index.htm" target="_blank">JS Minifier压缩</a></li><li><a href="http://www.jb51.net/tools/js_Debug.htm" target="_blank">在线JS脚本校验器错误</a></li><li><a href="http://tools.jb51.net/tools/regex.asp" target="_blank">JavaScript 正则表达式在线测试工具</a></li><li><a href="http://tools.jb51.net/tools/Escape.asp" target="_blank">Escape加解密</a></li><li><a href="http://www.jb51.net/tools/htmlto.htm" target="_blank">HTML多功能代码转换器</a></li><li><a href="http://www.jb51.net/tools/xunleijm.htm" target="_blank">迅雷快车加/解密</a></li></ul>
</div>
</div>
<div class="r300 clearfix mt10" id="idctu2"><a href="http://www.33ip.com/" target="_blank"><img src="./scoped_ptr shared_ptr weak_ptr_files/33ip_300.gif" width="300" height="100"></a><div class="blank10"></div><a href="http://www.enkj.com/special/20160315/" target="_blank"><img src="./scoped_ptr shared_ptr weak_ptr_files/enkj_300.gif" alt="云服务器" width="300" height="100"></a></div>
<div class="mt10 rFixedBox" id="r3" style="position: absolute; top: 0px;">
<script type="text/javascript">
var cpro_id="u1397867";
(window["cproStyleApi"] = window["cproStyleApi"] || {})[cpro_id]={at:"3",rsi0:"300",rsi1:"380",pat:"6",tn:"baiduCustNativeAD",rss1:"#FFFFFF",conBW:"1",adp:"1",ptt:"0",titFF:"%E5%BE%AE%E8%BD%AF%E9%9B%85%E9%BB%91",titFS:"14",rss2:"#000000",titSU:"0",ptbg:"90",piw:"0",pih:"0",ptp:"0"}
</script>
<script src="./scoped_ptr shared_ptr weak_ptr_files/c.js" type="text/javascript"></script><div id="BAIDU_SSP__wrapper_u1397867_0_placeholder" style="width: 300px; height: 380px; margin: 0px; padding: 0px; border: none; display: inline-block; background: none;"></div><div id="BAIDU_SSP__wrapper_u1397867_0" style="width: 300px; height: 380px; display: inline-block; z-index: 2147483646; position: fixed; left: 831px; top: 5px;"><iframe id="iframeu1397867_0" src="./scoped_ptr shared_ptr weak_ptr_files/hcom(10).html" width="300" height="380" align="center,center" vspace="0" hspace="0" marginwidth="0" marginheight="0" scrolling="no" frameborder="0" style="border:0; vertical-align:bottom;margin:0;" allowtransparency="true"></iframe></div>
</div>
      
      
      </div><!--end fr-->
      </div>
</div><!--end content-->
<div id="footer">
<div class="main clearfix">
<p>
<a href="http://www.jb51.net/about.htm" target="_blank">关于我们</a> - 
<a href="http://www.jb51.net/support.htm" target="_blank">广告合作</a> - 
<a href="http://www.jb51.net/linkus.htm" target="_blank">联系我们</a> -  
<a href="http://www.jb51.net/sm.htm" target="_blank">免责声明</a> -  
<a href="http://www.jb51.net/sitemap.htm" target="_blank">网站地图</a> - 
<a href="tencent://message/?uin=461478385&amp;Site=http://www.jb51.net" target="_blank">投诉建议</a> - 
<a href="http://www.jb51.net/up.htm" target="_blank">在线投稿</a>
</p>
<p>&#169;CopyRight 2006-2016 JB51.Net Inc All Rights Reserved. 脚本之家 版权所有</p>
</div>
</div><!--end footer-->
<link type="text/css" rel="stylesheet" href="./scoped_ptr shared_ptr weak_ptr_files/shCore.css">
<link type="text/css" rel="Stylesheet" href="./scoped_ptr shared_ptr weak_ptr_files/shThemeDefault.css">
<script type="text/javascript" src="./scoped_ptr shared_ptr weak_ptr_files/shCore.js"></script>
<script type="text/javascript" src="./scoped_ptr shared_ptr weak_ptr_files/shAutoloader.js"></script>
<script type="text/javascript"> 
if (top.location != self.location)top.location=self.location;
$('#content').find('img').each(function(){
        var img = this;
        if (img.width >= 650){
            img.style.width = "650px";
            img.style.height = "auto";
            //$(img).removeAttr('height');
            var aTag = document.createElement('a');
            aTag.href = img.src;
			aTag.target="_blank";
            $(aTag).addClass('bPic')
            .insertAfter(img).append(img)
          }
    });
 $(window).scroll(function()
    {	
    	//rFixedBox跟随滚动
    	var h = $(window).height();
        var top = $(window).scrollTop();
    	var rFixedBox = $('.rFixedBox').prev().offset();
        var fixedTop = rFixedBox.top;
		
        if(top>=fixedTop+344)
        {
			var h1 = parseInt($('#content').children('.main').height());
			if(parseInt(top) + 340 < h1){
				$('.rFixedBox').css({'position':'fixed','top': 0});
			}else{
				$('.rFixedBox').css({'position':'absolute','top': h1-510});
			}
        }
        else
        {
            $('.rFixedBox').css({'position':'static', 'top':0});   
        }	
       /* return true;*/
    });
SyntaxHighlighter.autoloader(
	'applescript			/jslib/syntaxhighlighter/scripts/shBrushAppleScript.js',
	'actionscript3 as3		/jslib/syntaxhighlighter/scripts/shBrushAS3.js',
	'bash shell				/jslib/syntaxhighlighter/scripts/shBrushBash.js',
	'coldfusion cf			/jslib/syntaxhighlighter/scripts/shBrushColdFusion.js',
	'cpp c					/jslib/syntaxhighlighter/scripts/shBrushCpp.js',
	'obj-c objc				/jslib/syntaxhighlighter/scripts/shBrushObjC.js',
	'c# c-sharp csharp		/jslib/syntaxhighlighter/scripts/shBrushCSharp.js',
	'css					/jslib/syntaxhighlighter/scripts/shBrushCss.js',
	'delphi pascal			/jslib/syntaxhighlighter/scripts/shBrushDelphi.js',
	'diff patch pas			/jslib/syntaxhighlighter/scripts/shBrushDiff.js',
	'erl erlang				/jslib/syntaxhighlighter/scripts/shBrushErlang.js',
	'groovy					/jslib/syntaxhighlighter/scripts/shBrushGroovy.js',
	'haxe hx				/jslib/syntaxhighlighter/scripts/shBrushHaxe.js',
	'java					/jslib/syntaxhighlighter/scripts/shBrushJava.js',
	'jfx javafx				/jslib/syntaxhighlighter/scripts/shBrushJavaFX.js',
	'js jscript javascript	/jslib/syntaxhighlighter/scripts/shBrushJScript.js',
	'perl pl				/jslib/syntaxhighlighter/scripts/shBrushPerl.js',
	'php					/jslib/syntaxhighlighter/scripts/shBrushPhp.js',
	'text plain				/jslib/syntaxhighlighter/scripts/shBrushPlain.js',
	'py python				/jslib/syntaxhighlighter/scripts/shBrushPython.js',
	'ruby rails ror rb		/jslib/syntaxhighlighter/scripts/shBrushRuby.js',
	'scala					/jslib/syntaxhighlighter/scripts/shBrushScala.js',
	'sql					/jslib/syntaxhighlighter/scripts/shBrushSql.js',
	'vb vbnet				/jslib/syntaxhighlighter/scripts/shBrushVb.js',
	'ps powershell			/jslib/syntaxhighlighter/scripts/shBrushPowerShell.js',
	'xml xhtml xslt html	/jslib/syntaxhighlighter/scripts/shBrushXml.js'
);
SyntaxHighlighter.all();
(function(){
    var bp = document.createElement('script');
    bp.src = '//push.zhanzhang.baidu.com/push.js';
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>
<script type="text/javascript" src="./scoped_ptr shared_ptr weak_ptr_files/a.js"></script><script src="./scoped_ptr shared_ptr weak_ptr_files/f.js" type="text/javascript"></script><div id="BAIDU_SSP__wrapper_u480030_0"></div>
<div id="tongji">
<script type="text/javascript" src="./scoped_ptr shared_ptr weak_ptr_files/tongji.js"></script><script src="./scoped_ptr shared_ptr weak_ptr_files/stat.php" language="JavaScript"></script><script src="./scoped_ptr shared_ptr weak_ptr_files/core.php" charset="utf-8" type="text/javascript"></script><a href="http://www.cnzz.com/stat/website.php?web_id=1585378" target="_blank" title="站长统计">站长统计</a><script src="./scoped_ptr shared_ptr weak_ptr_files/stat(1).php" language="JavaScript"></script><script src="./scoped_ptr shared_ptr weak_ptr_files/core(1).php" charset="utf-8" type="text/javascript"></script><a href="http://www.cnzz.com/stat/website.php?web_id=4180674" target="_blank" title="站长统计">站长统计</a><script src="./scoped_ptr shared_ptr weak_ptr_files/stat(2).php" language="JavaScript"></script><script src="./scoped_ptr shared_ptr weak_ptr_files/core(2).php" charset="utf-8" type="text/javascript"></script><a href="http://www.cnzz.com/stat/website.php?web_id=5488916" target="_blank" title="站长统计">站长统计</a><script src="./scoped_ptr shared_ptr weak_ptr_files/i.js" type="text/javascript"></script>
<script type="text/javascript" src="./scoped_ptr shared_ptr weak_ptr_files/pl.asp"></script>
</div>
<script>
(function(){
var appid = 'cyrHH3dwi',
conf = 'prod_1dc5dc80970106099d43fe242b7465fc';
var doc = document,
s = doc.createElement('script'),
h = doc.getElementsByTagName('head')[0] || doc.head || doc.documentElement;
s.type = 'text/javascript';
s.charset = 'utf-8';
s.src =  'http://assets.changyan.sohu.com/upload/changyan.js?conf='+ conf +'&appid=' + appid;
h.insertBefore(s,h.firstChild);
window.SCS_NO_IFRAME = true;
})();
window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"2","bdPic":"","bdStyle":"0","bdSize":"16"},"share":{}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];
</script>
<script type="text/javascript" charset="utf-8" src="./scoped_ptr shared_ptr weak_ptr_files/saved_resource"></script>


<!-- published at 2016-3-4 23:36:03By dxycms qq:461478385  -->
</div></body></html>